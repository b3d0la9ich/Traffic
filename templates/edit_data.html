<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/edit_data.css') }}">
  <script defer src="{{ url_for('static', filename='js/theme-toggle.js') }}"></script>
  <script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –º–µ—Å—è—Ü–∞
    function syncMonthMax() {
      const y = document.getElementById('year');
      const m = document.getElementById('month');
      if (!y || !m) return;
      if (y.value === '2025') {
        m.max = 12;  // –†–∞–∑—Ä–µ—à–∞–µ–º –º–µ—Å—è—Ü –¥–æ –¥–µ–∫–∞–±—Ä—è 2025
        if (parseInt(m.value || '0', 10) > 12) m.value = 12;
      } else {
        m.max = 12;  // –î–ª—è –¥—Ä—É–≥–∏—Ö –≥–æ–¥–æ–≤ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –º–µ—Å—è—Ü - –¥–µ–∫–∞–±—Ä—å
      }
    }

    // –í—ã–∑–æ–≤–µ–º syncMonthMax –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–π
    document.addEventListener('DOMContentLoaded', syncMonthMax);

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    function updatePreview() {
      const y = document.getElementById('year').value;
      const m = document.getElementById('month').value;
      const dateEl = document.getElementById('preview-date');
      const valEl = document.getElementById('preview-value');

      // –ï—Å–ª–∏ –≥–æ–¥ –∏–ª–∏ –º–µ—Å—è—Ü –Ω–µ –≤—ã–±—Ä–∞–Ω—ã
      if (!y || !m) {
        dateEl.textContent = '-';
        valEl.textContent = '–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
        return;
      }

      // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–ª—é—á –¥–ª—è –ø–æ–∏—Å–∫–∞
      const key = `${y}-${String(m).padStart(2, '0')}`;
      dateEl.textContent = key;

      // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∫–ª—é—á–∞
      const v = DATA_MAP[key];
      valEl.textContent = (v !== undefined) ? v : '–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
    }

    // –ó–∞–ø—É—Å–∫ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', updatePreview);
  </script>
</head>
<body>
  <div class="theme-toggle">
    <button id="toggle-theme">üåô</button>
  </div>

  <div class="form-card">
    <h2>–ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫–µ</h2>

    {% with messages = get_flashed_messages(with_categories=true, category_filter=['edit_success','edit_warning','edit_danger']) %}
      {% if messages %}
        <div class="flash-messages">
          {% for category, message in messages %}
            <div class="flash {{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- –§–æ—Ä–º–∞ –∏ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è -->
    <div class="edit-grid">
      <form method="POST" class="edit-form" autocomplete="off">
        <label for="year">–ì–æ–¥</label>
        <input id="year" type="number" name="year" min="2016" max="2025" required
               value="{{ request.form.get('year','') }}" oninput="syncMonthMax();updatePreview();">

        <label for="month">–ú–µ—Å—è—Ü</label>
        <input id="month" type="number" name="month" min="1" max="12" required
               value="{{ request.form.get('month','') }}" oninput="updatePreview();">

        <label for="passengers">–ù–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤</label>
        <input id="passengers" type="number" name="passengers" min="0" required
               value="{{ request.form.get('passengers','') }}">

        <button type="submit">–ò–∑–º–µ–Ω–∏—Ç—å</button>
      </form>

      <!-- –ë–ª–æ–∫ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è -->
      <aside class="preview">
        <div class="preview-title">–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</div>
        <div class="preview-line">
          <span id="preview-date">‚Äî</span>
          <span class="preview-sep">‚Üí</span>
          <span id="preview-value" class="preview-value">–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>
        </div>
        <small class="muted">–ü–æ–¥—Å–∫–∞–∑–∫–∞: –∏–∑–º–µ–Ω—è–π—Ç–µ –≥–æ–¥/–º–µ—Å—è—Ü —Å–ª–µ–≤–∞ ‚Äî –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–æ,
          —á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –∑–∞–º–µ–Ω–∏—Ç—å.</small>
      </aside>
    </div>


    <a class="back-link" href="{{ url_for('dashboard') }}">‚Üê –ù–∞–∑–∞–¥</a>
  </div>

  <!-- –ü–µ—Ä–µ–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
  <script>
    const DATA_MAP = JSON.parse('{{ data_map|tojson|safe }}');
  </script>
</body>
</html>
