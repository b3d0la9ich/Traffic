<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞–º–∏</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/incidents.css') }}">
    <script defer src="{{ url_for('static', filename='js/theme-toggle.js') }}"></script>
    <script>
      function updateDescCounter() {
        const el = document.getElementById('description');
        const counter = document.getElementById('descCounter');
        if (el && counter) {
          counter.textContent = (el.value || '').length + '/255';
        }
      }
      document.addEventListener('DOMContentLoaded', updateDescCounter);
    </script>
</head>
<body>
    <div class="theme-toggle">
        <button id="toggle-theme">üåô</button>
    </div>

    <div class="incident-card">
        <h2>–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏–µ</h2>

        {% with messages = get_flashed_messages(with_categories=true, category_filter=['inc_success','inc_warning','inc_danger']) %}
          {% if messages %}
            <div class="flash-messages">
              {% for category, message in messages %}
                <div class="flash {{ category }}">{{ message }}</div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <form method="POST">
            <label for="year">–ì–æ–¥ (—Ç–æ–ª—å–∫–æ 2026‚Äì2030):</label>
            <input id="year" type="number" name="year" min="2026" max="2030" required
                   value="{{ request.form.get('year','') }}">

            <label for="month">–ú–µ—Å—è—Ü:</label>
            <input id="month" type="number" name="month" min="1" max="12" required
                   value="{{ request.form.get('month','') }}">

            <label for="impact">–í–ª–∏—è–Ω–∏–µ (‚àí1.00 ‚Ä¶ 1.00; –Ω–∞–ø—Ä–∏–º–µ—Ä, ‚àí0.20 = ‚àí20%):</label>
            <input id="impact" type="number" name="impact" step="0.01" min="-1" max="1" required
                   placeholder="-0.20" title="–î–∏–∞–ø–∞–∑–æ–Ω: –æ—Ç -1.00 –¥–æ 1.00"
                   value="{{ request.form.get('impact','') }}">

            <label for="duration">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–≤ –º–µ—Å—è—Ü–∞—Ö):</label>
            <input id="duration" type="number" name="duration" min="1" max="12" required
                   value="{{ request.form.get('duration','') }}">

            <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ (–¥–æ 255 —Å–∏–º–≤–æ–ª–æ–≤):</label>
            <textarea id="description"
                      name="description"
                      maxlength="255"
                      oninput="updateDescCounter()"
                      rows="3"
                      placeholder="–ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ —Å–æ–±—ã—Ç–∏–µ...">{{ request.form.get('description','') }}</textarea>
            <div class="hint"><small id="descCounter">0/255</small></div>

            <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
        </form>

        <h3>–°–ø–∏—Å–æ–∫ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤</h3>
        <ul class="incident-list">
            {% for inc in incidents %}
            <li>
                <span class="date">{{ inc.year }}-{{ '%02d'|format(inc.month) }}</span>
                <span class="duration">({{ inc.duration }} –º–µ—Å)</span>
                <span class="impact">{{ (inc.impact * 100) | round(1) }}%</span>
                <span class="desc"> ‚Äî {{ inc.description }}</span>
            </li>
            {% endfor %}
        </ul>

        <a class="back-link" href="{{ url_for('dashboard') }}">‚Üê –ù–∞–∑–∞–¥</a>
    </div>
</body>
</html>
